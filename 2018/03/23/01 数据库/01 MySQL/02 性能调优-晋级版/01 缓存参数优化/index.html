<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		01 缓存参数优化 | 
	 
	Yishto&#39;s notes
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	


	<!-- search -->
	<script>
		var searchEngine = "https://www.google.com/search?q=";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "yishto.top";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3efe99c287df5a1d6f0d02d187e403c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<header id="header">
    <a id="title" href="/" class="logo">Yishto's notes</a>

	<ul id="menu">
		<li class="menu-item">
			
		</li>
	
		<li class="menu-item">
			<a href="/tags" class="menu-item-link">标签</a>
		</li>
	

	
		<li class="menu-item">
			<a href="/categories" class="menu-item-link">分类</a>
		</li>
	


		<li class="menu-item">
			<a href="https://github.com/Yishto" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="按回车全站搜索">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 数据库
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 MySQL
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 性能调优-基础版
									</a>
									
							<ul>
								<li class="file">
									<a href="/2018/03/20/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/01%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E5%9F%BA%E7%A1%80%E7%89%88/01%E5%A6%82%E4%BD%95%E5%8F%91%E7%8E%B0%E6%9C%89%E9%97%AE%E9%A2%98%E7%9A%84SQL/">
										01如何发现有问题的SQL
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/03/20/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/01%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E5%9F%BA%E7%A1%80%E7%89%88/02%20%E7%B4%A2%E5%BC%95%E7%9A%84%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95/">
										02 索引的优化方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/03/22/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/01%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E5%9F%BA%E7%A1%80%E7%89%88/03%20%E5%85%B6%E5%AE%83%E4%BC%98%E5%8C%96%E6%96%B9%E6%B3%95/">
										03 其它优化方法
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/03/22/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/01%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E5%9F%BA%E7%A1%80%E7%89%88/04%20%E8%A1%A8%E7%9A%84%E6%8B%86%E5%88%86%E4%BC%98%E5%8C%96/">
										04 表的拆分优化
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 性能调优-晋级版
									</a>
									
							<ul>
								<li class="file active">
									<a href="/2018/03/23/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/02%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E6%99%8B%E7%BA%A7%E7%89%88/01%20%E7%BC%93%E5%AD%98%E5%8F%82%E6%95%B0%E4%BC%98%E5%8C%96/">
										01 缓存参数优化
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/03/23/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/02%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E6%99%8B%E7%BA%A7%E7%89%88/02%20%E8%A1%A8%E7%BB%93%E6%9E%84%E4%BC%98%E5%8C%96/">
										02 表结构优化
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/03/24/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/02%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E6%99%8B%E7%BA%A7%E7%89%88/03%20%E7%B4%A2%E5%BC%95%E4%BC%98%E5%8C%96/">
										03 索引优化
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/03/26/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/02%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E6%99%8B%E7%BA%A7%E7%89%88/04%20SQL%E4%BC%98%E5%8C%96/">
										04 SQL优化
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2018/03/28/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/02%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E6%99%8B%E7%BA%A7%E7%89%88/05%20%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E%E9%80%89%E6%8B%A9/">
										05 存储引擎选择
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 数据结构与算法
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/05/20/02%20%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/index/">
										index
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										03 计算机组成原理
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/05/20/03%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/index/">
										index
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										04 操作系统
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/05/20/04%20%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/index/">
										index
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										05 计算机网络
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/05/20/05%20%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/index/">
										index
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										06 系统设计
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/05/20/06%20%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/index/">
										index
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										07 分布式
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/05/20/07%20%E5%88%86%E5%B8%83%E5%BC%8F/index/">
										index
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										08 服务器
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/05/20/08%20%E6%9C%8D%E5%8A%A1%E5%99%A8/index/">
										index
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										09 笔记梳理
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/05/20/09%20%E7%AC%94%E8%AE%B0%E6%A2%B3%E7%90%86/index/">
										index
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										10 其他
									</a>
									
							<ul>
								<li class="file">
									<a href="/2021/05/20/10%20%E5%85%B6%E4%BB%96/index/">
										index
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	01 缓存参数优化
</h1>
<div class="article-meta">
	
	<span>Yishto</span>
	<span>2018-03-23 08:32:54</span>
		<div id="article-categories">
    
		<span>Categories：</span>
            
    

    
		<span>Tags：</span>
            
    
		</div>

</div>

<div id="article-content">
	<ul>
<li><p>数据库属于 <strong>IO</strong> 密集型的应用程序 , 其主要职责就是数据的管理及存储工作 . 而我们知道 , 从内从中读取一个数据库的时间是微秒级别 , 而从一块普通硬盘读取一个 <strong>IO</strong> 是在微秒级别 , 二者相差3个数量级 . 所以 , 要手滑数据库 , 首相第一步需要优化的就是 <strong>IO</strong> , 进可能的将磁盘 <strong>IO</strong>转化为内存 <strong>IO</strong> . 本文先从Mysql 数据库IO相关参数(缓存参数)的角度来看看可以通过哪些参数进行IO优化:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">query_cache_size/query_cache_type(global)</span><br></pre></td></tr></table></figure>
<p>Query cache 错用与整个Mysql Instance , 主要用来缓存Mysql 中的 ResultSet , 也就是一条 SQL 语句执行的结果集 , 所以仅仅只能针对 select 语句 . 当我们打开了qUERY Cache 功能 , Mysql 在接收到一条select 语句的请求后 , 如果该语句满足Query Cache 的要求(未显示说明不允许使用Query Cache , 或者已经显示声明需要使用Query Cache) , Mysql 会直接根据预先设定好的HASH算法将接收到select 语句以字符串方式进行hash , 然后到Query Cache 中直接查找是否已经缓存 . 也就是说 , 如果已经在缓存中 , 该 select 请求就会直接将数据返回 , 从而省略了后面所有的步骤 , (如果 SQL 语句的解析 , 优化器优化以及向存储引擎请求数据等 ) , 极大的提高性能 .<br>当然 , Query Cache 也有一个致命的缺陷 , 那就是当某个表的数据有任何变化 , 都会导致素有引用了该表的select 语句在 Query Cache 中的缓存数据失效 , 所以 , 当我们的数据变化非常频繁的的情况下 , 使用 Query Cache 可能会得不偿失 .<br>Query Cache 的使用需要多个参数配合 , 其中最关键的就是 query_cache_size  和 query_cache_type , 前者设置用于缓存 ResultSet 的内存大小 , 后者设置在任何场景下使用 Query Cache . 在以往的经验看来 , 如果不是用来缓存基本不变的数据的Mysql 数据库 , query_cache_size 一般256M 是一个比较合适的大小 , 当然 , 这可以通过计算 Query Cache 的命中率 (Qcache_hits/(Qcache_hits+Qcache_inserts)*100) 来进行调整 .  query_cache_type 可以设置为0(OFF) , 1(ON) 或者 2(DEOND) , 分别表示不完全使用query cache , 除显示要求不使用query cache(使用sql_no_cache)之外的所有select 都使用 query cache ,只用显示要求才使用query cache (使用 sql_cache) . </p>
</li>
<li><p>binlog_cache_size(global)<br>Binlog Cache 用于在打开了二进制日志(binlog)记录功能的环境 , 是 Mysql  用来提高binlog 的记录效率而设计的一个用于短时间内临时缓存binlog数据的内存区域 .<br>一般来说 , 如果我们的数据库中没有什么大事务 , 写入也是特别频繁 , 2MB ~ 4MB 是一个合适的选择 . 但是如果我们的数据库大事务较多 , 写入量比较大 , 可以适当调高 binlog_cache_size . 同时 , 我们可以通过 binlog_cache_use 以及 binlog_cache_disk_use 来分析设置的binog_cache_size 是否足够 , 是否有大量的binlog_cache 由于内存大小不够而使用临时文件(binlog_cache_disk_use) 来缓存了 . </p>
</li>
<li><p>key_buffer_size (global)<br>Key Buffer  可能是大家最为熟悉的一个Mysql 缓存参数了, 尤其是在Mysql 没有变更 默认存储引擎的时候 , 很多朋友可能会发现 , 默认的Mysql 配置文件中设置最大的一个内存参数就是这个参数了 .<br>key_buffer_size 参数用来设置用于缓存MyISAM 存储引擎中索引文件的内存大小 , 如果我们有足够的内存 , 这个缓存区域最好是能够存放我们所有的MyISAM 引擎表的所有索引 , 以因可能提高性能 .<br>此外 , 当我们在使用MyISAM 存储的时候有一个及其重要的点需要注意 , 由于MyISAM 引擎的特性闲着了他仅仅只会缓存索引块到内存中 , 而不会缓存表数据库块 . 所以 , 我们的 SQL 一定要尽可能让过滤条件都在索引中 , 一遍缓存帮助我们提高查询效率 . </p>
</li>
<li><p>bulk_insert_buffer_size(thread)<br>和 key_buffer_size 一样 , 这个参数同样也仅作用于使用MyISAM存储引擎 , 用来缓存批量插入数据的时候临时缓存写入数据 . 当我们使用如果集中数据写入语句的时候 , 会使用这个内存区域来缓存批量结构的数据以帮助批量写入数据 :</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">insert ... select ...</span><br><span class="line">insert ... value (...) , (...) , (...) ...</span><br><span class="line">load data infile ... into ...(非空表)</span><br></pre></td></tr></table></figure></li>
<li><p>innodb_buffer_size(global)<br>当我们使用Innodb存储引擎的使用, innodb_buffer_pool_size 参数可能是影响我们性能的最为关键的一个参数了 , 它用来设置用于缓存 InnoDB 索引 及数据块的内存区域大小 , 类似于 MyISAM 存储引擎的key_buffer_size 参数 , 当然 , 可能更像是 Oracle 的db_cache_size . 简单来书 , 当我们操作一个InnoDB 表的时候, 返回的所有数据或者取数据过程中用到的任何一个索引块 , 都会在这个内存区域中走一遭 .<br>和key_buffer_size 对于MyISAM引擎一样 , innodb_buffer_pool_size 设置了 InnoDB 存储引擎需求最大的一块内存区域的大小 ， 直接关系到InnoDB 存储引擎的性能 ， 所以如果我们有足够的内存 ， 尽可能将这个参数设置的足够大 ， 将尽可能多的 InnoDB 的索引及数据都存入到该缓存区域中 ， 直至全部 .<br>我们可以通过(Innodb_buffer_pool_read_request – Innodb_buffer_pool_reads) / Innodb_buffer_pool_read_request * 100% 计算缓存命中率 , 并根据命中率来调整 innodb_buffer_pool_size 参数大小进行优化 . </p>
</li>
<li><p>innodb_additional_mem_pool_size (global)<br>这个参数我们平时调整的可能不是太多 , 很多人都是用了默认值 , 可能很多人都不是太熟悉这个参数的作用 . innodb_additional_mem_pool_size 设置了 InnoDB 存储引擎用来存放数据字典信息以及一些内部数据结构的内存大小 , 所以当我们一个Mysql instance 中的数据库对象非常多的时候 , 是需要适当调整该参数的大小以确保所有数据都存放在内从中提高访问的效率的 .<br>这个参数的大小是否足够还是比较容易知道的 , 因为当过小的时候 ,Mysql 会记录Waring 信息到数据库的 error log 中, 这时候你就知道该调整这个参数大小了 . </p>
</li>
</ul>

</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2018/03/23/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/02%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E6%99%8B%E7%BA%A7%E7%89%88/02%20%E8%A1%A8%E7%BB%93%E6%9E%84%E4%BC%98%E5%8C%96/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  02 表结构优化
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2018/03/22/01%20%E6%95%B0%E6%8D%AE%E5%BA%93/01%20MySQL/01%20%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98-%E5%9F%BA%E7%A1%80%E7%89%88/04%20%E8%A1%A8%E7%9A%84%E6%8B%86%E5%88%86%E4%BC%98%E5%8C%96/">
                04 表的拆分优化
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>



	<div id="vcomments"></div>


<script>
	
		// 评论
		new Valine({
			av: AV,
			el: '#vcomments',
			notify: false,
			verify: false,
			path: window.location.pathname,
			appId: '',
			appKey: '',
			placeholder: '请输入评论',
			avatar: 'retro',
			recordIP: false
		})
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2018-<span id="footerYear"></span>
	Yishto

	
		|
		<span id="busuanzi_container_site_pv">
			pv
			<span id="busuanzi_value_site_pv"></span>
		</span>
		|
		<span id="busuanzi_container_site_uv">
			uv
			<span id="busuanzi_value_site_uv"></span>
		</span>
	
	<br>
	Theme Tree Powered by Hexo
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>